<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>è³‡ç”£ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body{
    margin:0;
    font-family:Arial;
    background:#f4f6f9;
}
header{
    background:#1f2937;
    color:white;
    padding:15px;
    font-size:20px;
}
.container{
    padding:20px;
}
.card{
    background:white;
    padding:20px;
    border-radius:12px;
    margin-bottom:20px;
    box-shadow:0 4px 10px rgba(0,0,0,0.05);
}
.flex{
    display:flex;
    gap:20px;
    flex-wrap:wrap;
}
input,select,button{
    padding:8px;
    margin:5px 0;
}
button{
    background:#2563eb;
    color:white;
    border:none;
    border-radius:6px;
}
h2{
    margin-top:0;
}
.total{
    font-size:24px;
    font-weight:bold;
}
.green{color:green;}
.red{color:red;}
table{
    width:100%;
    border-collapse:collapse;
}
th,td{
    padding:6px;
    border-bottom:1px solid #ddd;
    text-align:center;
}
</style>
</head>
<body>

<header>ğŸ’° è³‡ç”£ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</header>

<div class="container">

<div class="card">
<h2>ç·è³‡ç”£</h2>
<div class="total" id="totalAssets">Â¥0</div>
</div>

<div class="card">
<h2>å£åº§è¿½åŠ </h2>
<input type="text" id="accountName" placeholder="å£åº§å">
<input type="number" id="accountAmount" placeholder="æ®‹é«˜">
<button onclick="addAccount()">è¿½åŠ </button>
<ul id="accountList"></ul>
</div>

<div class="card">
<h2>å®¶è¨ˆç°¿å…¥åŠ›</h2>
<input type="date" id="date">
<select id="accountSelect"></select>
<select id="type">
<option value="income">åå…¥</option>
<option value="expense">æ”¯å‡º</option>
</select>
<select id="category">
<option>é£Ÿè²»</option>
<option>å›ºå®šè²»</option>
<option>å¨¯æ¥½</option>
<option>æŠ•è³‡</option>
<option>çµ¦æ–™</option>
<option>ãã®ä»–</option>
</select>
<input type="number" id="amount" placeholder="é‡‘é¡">
<button onclick="addTransaction()">è¿½åŠ </button>

<table>
<thead>
<tr><th>æ—¥ä»˜</th><th>å£åº§</th><th>åˆ†é¡</th><th>é‡‘é¡</th></tr>
</thead>
<tbody id="transactionList"></tbody>
</table>
</div>

<div class="flex">

<div class="card" style="flex:1;">
<h2>æœˆåˆ¥åæ”¯</h2>
<canvas id="monthlyChart"></canvas>
</div>

<div class="card" style="flex:1;">
<h2>ã‚«ãƒ†ã‚´ãƒªåˆ¥æ”¯å‡º</h2>
<canvas id="categoryChart"></canvas>
</div>

</div>

<div class="card">
<h2>è³‡ç”£æ¨ç§»</h2>
<canvas id="assetChart"></canvas>
</div>

</div>

<script>
let accounts = JSON.parse(localStorage.getItem("accounts"))||[];
let transactions = JSON.parse(localStorage.getItem("transactions"))||[];

function save(){
localStorage.setItem("accounts",JSON.stringify(accounts));
localStorage.setItem("transactions",JSON.stringify(transactions));
}

function addAccount(){
const name=accountName.value;
const amount=parseFloat(accountAmount.value);
if(!name||isNaN(amount))return;
accounts.push({name,amount});
save();
render();
}

function addTransaction(){
const date=document.getElementById("date").value;
const account=document.getElementById("accountSelect").value;
const type=document.getElementById("type").value;
const category=document.getElementById("category").value;
const amount=parseFloat(document.getElementById("amount").value);
if(!date||!account||isNaN(amount))return;

transactions.push({date,account,type,category,amount});
accounts.forEach(a=>{
if(a.name===account){
a.amount+= type==="income"?amount:-amount;
}
});
save();
render();
}

function render(){
renderAccounts();
renderTransactions();
renderCharts();
}

function renderAccounts(){
accountList.innerHTML="";
accountSelect.innerHTML="";
let total=0;
accounts.forEach(a=>{
total+=a.amount;
accountList.innerHTML+=`<li>${a.name} : Â¥${a.amount.toLocaleString()}</li>`;
accountSelect.innerHTML+=`<option>${a.name}</option>`;
});
totalAssets.innerText="Â¥"+total.toLocaleString();
}

function renderTransactions(){
transactionList.innerHTML="";
transactions.forEach(t=>{
let sign=t.type==="income"?"+":"-";
transactionList.innerHTML+=`
<tr>
<td>${t.date}</td>
<td>${t.account}</td>
<td>${t.category}</td>
<td class="${t.type==="income"?"green":"red"}">
${sign}Â¥${t.amount.toLocaleString()}
</td>
</tr>`;
});
}

let monthlyChart,categoryChart,assetChart;

function renderCharts(){

let monthly={};
let category={};
let assetHistory=[];
let total=0;

accounts.forEach(a=>total+=a.amount);
assetHistory.push(total);

transactions.forEach(t=>{
let month=t.date.slice(0,7);
if(!monthly[month])monthly[month]=0;
monthly[month]+=t.type==="income"?t.amount:-t.amount;

if(t.type==="expense"){
if(!category[t.category])category[t.category]=0;
category[t.category]+=t.amount;
}
});

if(monthlyChart)monthlyChart.destroy();
monthlyChart=new Chart(monthlyChart=document.getElementById("monthlyChart"),{
type:"bar",
data:{
labels:Object.keys(monthly),
datasets:[{label:"æœˆåæ”¯",data:Object.values(monthly)}]
}
});

if(categoryChart)categoryChart.destroy();
categoryChart=new Chart(categoryChart=document.getElementById("categoryChart"),{
type:"pie",
data:{
labels:Object.keys(category),
datasets:[{data:Object.values(category)}]
}
});

if(assetChart)assetChart.destroy();
assetChart=new Chart(assetChart=document.getElementById("assetChart"),{
type:"line",
data:{
labels:["ç¾åœ¨"],
datasets:[{label:"ç·è³‡ç”£",data:assetHistory}]
}
});
}

render();
</script>

</body>
</html>
