<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>è³‡ç”£ç®¡ç†Pro</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body{margin:0;font-family:Arial;background:#f3f4f6;}
header{background:#111827;color:white;padding:15px;text-align:center;font-size:20px;}
.container{padding:15px;padding-bottom:80px;}
.card{background:white;padding:15px;border-radius:12px;margin-bottom:15px;box-shadow:0 3px 8px rgba(0,0,0,0.05);}
h2{margin:0 0 10px;}
input,select,button{padding:6px;margin:4px 0;}
button{background:#2563eb;color:white;border:none;border-radius:6px;}
.total{font-size:22px;font-weight:bold;}
.progress{background:#e5e7eb;border-radius:6px;height:20px;overflow:hidden;}
.progress-bar{background:#10b981;height:100%;text-align:center;color:white;font-size:12px;}
.alert{color:red;font-weight:bold;}
nav{position:fixed;bottom:0;width:100%;background:white;border-top:1px solid #ddd;display:flex;justify-content:space-around;padding:10px 0;}
nav button{background:none;color:#2563eb;font-weight:bold;}
.hidden{display:none;}
</style>
</head>
<body>

<header>ğŸ’° è³‡ç”£ç®¡ç†Pro</header>

<div class="container">

<div class="card">
<h2>æœˆåˆ‡æ›¿</h2>
<button onclick="changeMonth(-1)">â—€</button>
<span id="currentMonth"></span>
<button onclick="changeMonth(1)">â–¶</button>
</div>

<div class="card">
<h2>ç·è³‡ç”£</h2>
<div class="total" id="totalAssets">Â¥0</div>
</div>

<div class="card">
<h2>äºˆç®—ç®¡ç†</h2>
<input type="number" id="budgetInput" placeholder="æœˆäºˆç®—">
<button onclick="setBudget()">è¨­å®š</button>
<div class="progress">
<div id="budgetBar" class="progress-bar">0%</div>
</div>
<div id="budgetAlert" class="alert"></div>
</div>

<div class="card">
<h2>å›ºå®šè²»ç™»éŒ²</h2>
<input type="text" id="fixedName" placeholder="é …ç›®">
<input type="number" id="fixedAmount" placeholder="é‡‘é¡">
<button onclick="addFixed()">ç™»éŒ²</button>
<button onclick="applyFixed()">ä»Šæœˆåæ˜ </button>
<ul id="fixedList"></ul>
</div>

<div class="card">
<h2>å®¶è¨ˆç°¿å…¥åŠ›</h2>
<input type="date" id="date">
<select id="type">
<option value="income">åå…¥</option>
<option value="expense">æ”¯å‡º</option>
</select>
<select id="category">
<option>é£Ÿè²»</option>
<option>å›ºå®šè²»</option>
<option>å¨¯æ¥½</option>
<option>æŠ•è³‡</option>
<option>ãã®ä»–</option>
</select>
<input type="number" id="amount" placeholder="é‡‘é¡">
<button onclick="addTransaction()">è¿½åŠ </button>
</div>

<div class="card">
<h2>ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼</h2>
<select id="filterCategory" onchange="render()">
<option value="all">å…¨ã¦</option>
<option>é£Ÿè²»</option>
<option>å›ºå®šè²»</option>
<option>å¨¯æ¥½</option>
<option>æŠ•è³‡</option>
<option>ãã®ä»–</option>
</select>
</div>

<div class="card">
<h2>æœˆåˆ¥åæ”¯</h2>
<canvas id="monthlyChart"></canvas>
</div>

</div>

<nav>
<button onclick="scrollToTop()">TOP</button>
</nav>

<script>
let transactions=JSON.parse(localStorage.getItem("transactions"))||[];
let fixed=JSON.parse(localStorage.getItem("fixed"))||[];
let budget=JSON.parse(localStorage.getItem("budget"))||0;
let current=new Date();

function save(){
localStorage.setItem("transactions",JSON.stringify(transactions));
localStorage.setItem("fixed",JSON.stringify(fixed));
localStorage.setItem("budget",JSON.stringify(budget));
}

function changeMonth(n){
current.setMonth(current.getMonth()+n);
render();
}

function setBudget(){
budget=parseFloat(budgetInput.value)||0;
save();
render();
}

function addFixed(){
fixed.push({name:fixedName.value,amount:parseFloat(fixedAmount.value)});
save();
render();
}

function applyFixed(){
let month=current.toISOString().slice(0,7);
fixed.forEach(f=>{
transactions.push({date:month+"-01",type:"expense",category:"å›ºå®šè²»",amount:f.amount});
});
save();
render();
}

function addTransaction(){
transactions.push({
date:date.value,
type:type.value,
category:category.value,
amount:parseFloat(amount.value)
});
save();
render();
}

let chart;

function render(){
currentMonth.innerText=current.toISOString().slice(0,7);
fixedList.innerHTML="";
fixed.forEach(f=>fixedList.innerHTML+=`<li>${f.name} Â¥${f.amount}</li>`);

let month=current.toISOString().slice(0,7);
let total=0;
let expense=0;
let monthly=0;

transactions.forEach(t=>{
if(t.date.startsWith(month)){
let signed=t.type==="income"?t.amount:-t.amount;
monthly+=signed;
if(t.type==="expense")expense+=t.amount;
}
});

totalAssets.innerText="Â¥"+monthly.toLocaleString();

let percent=budget?Math.round((expense/budget)*100):0;
budgetBar.style.width=percent+"%";
budgetBar.innerText=percent+"%";
budgetAlert.innerText=percent>100?"âš  äºˆç®—è¶…éï¼":"";

if(chart)chart.destroy();
chart=new Chart(document.getElementById("monthlyChart"),{
type:"bar",
data:{
labels:[month],
datasets:[{label:"æœˆåæ”¯",data:[monthly]}]
}
});
}

function scrollToTop(){window.scrollTo({top:0,behavior:"smooth"});}

render();
</script>

</body>
</html>
